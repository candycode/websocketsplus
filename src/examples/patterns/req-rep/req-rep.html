<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src=
                    "https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript">
        function ab2str(buf) {
            return String.fromCharCode.apply(null, new Uint8Array(buf));
        }

        $(function() {

           window.WebSocket = window.WebSocket || window.MozWebSocket;

           var websocket = new WebSocket('ws://127.0.0.1:9001',
                                         'reverse');

           websocket.binaryType = "arraybuffer";

           websocket.onopen = function () {
               $('h1').css('color', 'green');
           };

           websocket.onerror = function (e) {
               $('h1').css('color', 'red');
               console.log(e.msg);
           };
           websocket.onmessage = function (e) {
               $('#output p').css('font-family', 'Courier New');
               $('#output p').append($('<p>', { html:  ab2str(e.data) }));

           };
           function sendText(msg) {
              try {
                var buffer = new Array();
                for(var i = 0; i < msg.length; i++) buffer[i] = msg[i];
                var sbuf = buffer.join("");
                websocket.send(sbuf);
              } catch(except) {
                console.log(except);
              }
           }
           $('button').click(function(e) {
              try {
                  e.preventDefault();
                  if($('#text').val().length == 0) return;
                  sendText($('#text').val());
              } catch(except) {
                console.log(except);
              }
           });
        });
       </script>
</head>
<body>
<h1>WebSockets request-reply test</h1>
<form>
    <div>
        <p>Protocol ('reverse' or 'echo') - not implemented yet</p>
        <input id="proto" type="text"/>
    </div>
    <div>
        <h2>Input</h2>
        <input id="text" type="text" />
    </div>
    <button>Send</button>
</form>
<div id="output">
    <h2>Output</h2>
    <p></p>
</div>
</body>
</html>

